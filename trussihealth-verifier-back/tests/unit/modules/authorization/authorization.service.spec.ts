import { AuthorizationService } from '../../../../src/modules/authorization/authorization.service';
import {
  OauthToken,
  OpenIdApi,
} from '../../../../src/modules/shared/infrastructure/openIdAPI';
import { mock } from 'jest-mock-extended';
import { AuthorizationDto } from '../../../../src/modules/authorization/authorization.controller';

const idTokenForEthrPresentation =
  'eyJhbGciOiJSUzI1NiIsImtpZCI6InB1YmxpYzozYTFlM2RkYS1iOWVhLTQwYjctOGEwOS0wYjY5ZWQwZDMxMTYiLCJ0eXAiOiJKV1QifQ.eyJhdF9oYXNoIjoiSmN3UWlJamFxdVJZTjdwaWZQYnRCQSIsImF1ZCI6WyJ1bml2ZXJzYWwtdmVyaWZpZXIiXSwiYXV0aF90aW1lIjoxNjc4NzgwNDY5LCJkaWQiOiJkaWQ6ZXRocjoweEVlQkJkREZDYjVERjEyMWUyMWQ0NTI2Q0Y2Yjg0N2VGYUZjM2ZmODEiLCJleHAiOjE2Nzg3ODQwNzAsImlhdCI6MTY3ODc4MDQ3MCwiaXNzIjoiaHR0cHM6Ly9kZXYudmlkY2hhaW4ubmV0LyIsImp0aSI6IjRhNmI1MWUxLTA0ODktNDgyYS05NGM1LTdjMTYwYjg3OWMxNyIsIm5vbmNlIjoiOGU1MTUxODUtYzk1ZS00YTc1LTgxNGQtZjJkYTI5YWFjNzlkIiwicmF0IjoxNjc4NzgwNDI0LCJzaWQiOiI3YmIwNDFjZi0yNjM3LTQ0ZjItODI4OS0zZTE1YWY0OWE1NzMiLCJzdWIiOiJkaWQ6ZXRocjoweEVlQkJkREZDYjVERjEyMWUyMWQ0NTI2Q0Y2Yjg0N2VGYUZjM2ZmODEiLCJzdWJfandrIjp7ImNydiI6InNlY3AyNTZrMSIsImtpZCI6IlZTbnl4NWE4R1VMZ2pqZS94bWpJMTl6Rk5lc0FHM3dlT2kwSS91TkZzTVE9Iiwia3R5IjoiRUMiLCJ4IjoidENPQ3hQOEVMRW1rTGJXT2o2bExTdjhRdDA5RDFSMENGX0RsSVM1RDM3VSIsInkiOiJneXEwYWltQkZ6OWQ4T2wtSThMU3lhSTFZZ1dBV0tpRlBPb0ZvbjhiXy1nIn0sInZwIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy9ucy9kaWQvdjEiXSwicHJvb2YiOnsiY3JlYXRlZCI6IjIwMjMtMDMtMTRUMDc6NTQ6MjQuMDAwWiIsImp3cyI6ImV5SmhiR2NpT2lKRlV6STFOa3N0VWlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcFlYUWlPakUyTnpnM09EQTBOalFzSW1semN5STZJbVJwWkRwbGRHaHlPakI0UldWQ1FtUkVSa05pTlVSR01USXhaVEl4WkRRMU1qWkRSalppT0RRM1pVWmhSbU16Wm1ZNE1TSXNJblp3SWpwN0lrQmpiMjUwWlhoMElqcGJJbWgwZEhCek9pOHZkM2QzTG5jekxtOXlaeTl1Y3k5a2FXUXZkakVpWFN3aWRIbHdaU0k2SWxabGNtbG1hV0ZpYkdWUWNtVnpaVzUwWVhScGIyNGlMQ0oyWlhKcFptbGhZbXhsUTNKbFpHVnVkR2xoYkNJNlczc2lRR052Ym5SbGVIUWlPbHNpYUhSMGNITTZMeTkzZDNjdWR6TXViM0puTHpJd01UZ3ZZM0psWkdWdWRHbGhiSE12ZGpFaUxDSm9kSFJ3Y3pvdkwyRndhUzUyYVdSamFHRnBiaTV1WlhRdllYQnBMM1l4TDJOdmJuUmxlSFJ6TDNZeElsMHNJbU55WldSbGJuUnBZV3hUZEdGMGRYTWlPbnNpYVdRaU9pSm9kSFJ3Y3pvdkwyUmxkaTUyYVdSamFHRnBiaTV1WlhRdllYQnBMM1l4TDNKbGRtOWpZWFJwYjI0dlkzSmxaR1Z1ZEdsaGJDMXpkR0YwZFhNdmMzUmhkSFZ6TFd4cGMzUXZNakE1TDJOeVpXUmxiblJwWVd3dk1qZ2lMQ0p6ZEdGMGRYTk1hWE4wUTNKbFpHVnVkR2xoYkNJNkltaDBkSEJ6T2k4dlpHVjJMblpwWkdOb1lXbHVMbTVsZEM5aGNHa3ZkakV2Y21WMmIyTmhkR2x2Ymk5emRHRjBkWE10YkdsemRDOHlNRGtpTENKemRHRjBkWE5NYVhOMFNXNWtaWGdpT2lJeU9DSXNJblI1Y0dVaU9pSlNaWFp2WTJGMGFXOXVUR2x6ZERJd01qRWlmU3dpWTNKbFpHVnVkR2xoYkZOMVltcGxZM1FpT25zaWFXUWlPaUprYVdRNlpYUm9jam93ZUVWbFFrSmtSRVpEWWpWRVJqRXlNV1V5TVdRME5USTJRMFkyWWpnME4yVkdZVVpqTTJabU9ERWlMQ0owWlhOMElqb2libVYzVkdWemRDSjlMQ0pwWkNJNkltaDBkSEJ6T2k4dllYQnBMblpwWkdOb1lXbHVMbTVsZEM5aGNHa3ZkakV2YzJOb1pXMWhjeTg1T1RrNUlpd2lhWE56ZFdGdVkyVkVZWFJsSWpvaU1qQXlNeTB3TXkweE0xUXdPVG8xTlRveU1TNHdNREJhSWl3aWFYTnpkV1Z5SWpwN0ltbGtJam9pWkdsa09tVjBhSEk2TUhoRk1XUTRNa0UzTlVVd1l6VTVOVUUxTnpVMU1FVTJSVEkyTlRKaU1EVXhORU0yT0VFMk1HSXpJaXdpYm1GdFpTSTZJbFJsYzNScGJtY2dSR1YyWld4dmNHVnljeUo5TENKd2NtOXZaaUk2ZXlKamNtVmhkR1ZrSWpvaU1qQXlNeTB3TXkweE0xUXdPVG8xTlRveU1TNHdNREJhSWl3aWFuZHpJam9pWlhsS2FHSkhZMmxQYVVwR1ZYcEpNVTVyYzJsTVEwcHlZVmRSYVU5cFNtdGhWMUUyV2xoU2IyTnFiM2RsUlZWNFdrUm5lVkZVWXpGU1ZFSnFUbFJyTVZGVVZUTk9WRlYzVWxSYVJrMXFXVEZOYlVsM1RsUkZNRkY2V1RSUlZGbDNXV3BOYW1FeVZqVmplVEI0U1dsM2FXUkliSGRKYW05cFUyeGtWVWx1TUM1bGVVcHdXVmhSYVU5cVJUSk9lbWN6VFVSRmVrMXFSWE5KYld4NlkzbEpOa2x0VW5CYVJIQnNaRWRvZVU5cVFqUlNWRVpyVDBSS1FrNTZWa1pOUjAweFQxUldRazVVWXpGT1ZFSkdUbXRWZVU1cVZYbFpha0V4VFZSU1JFNXFhRUpPYWtKcFRYbEpjMGx1V21wSmFuQTNTV3RDYW1JeU5UQmFXR2d3U1dwd1lrbHRhREJrU0VKNlQyazRkbVF6WkROTWJtTjZURzA1ZVZwNU9IbE5SRVUwVERKT2VWcFhVbXhpYmxKd1dWZDRla3d6V1hoSmFYZHBZVWhTTUdOSVRUWk1lVGxvWTBkcmRXUnRiR3RaTW1ob1lWYzBkV0p0VmpCTU1rWjNZVk01TWsxVE9XcGlNalV3V2xob01HTjVPVEpOVTBwa1RFTkthbU50Vm10YVZ6VXdZVmRHYzFVelVtaGtTRlo2U1dwd04wbHRiR3RKYW05cFlVaFNNR05JVFRaTWVUbHJXbGhaZFdSdGJHdFpNbWhvWVZjMGRXSnRWakJNTWtaM1lWTTVNazFUT1hsYVdGcDJXVEpHTUdGWE9YVk1NazU1V2xkU2JHSnVVbkJaVjNkMFl6TlNhR1JJVm5wTU0wNHdXVmhTTVdONU1YTmhXRTR3VEhwSmQwOVRPV3BqYlZacldsYzFNR0ZYUm5OTWVrazBTV2wzYVdNelVtaGtTRlo2VkVkc2VtUkZUbmxhVjFKc1ltNVNjRmxYZDJsUGFVcHZaRWhTZDJONmIzWk1NbEpzWkdrMU1tRlhVbXBoUjBad1ltazFkVnBZVVhaWldFSndURE5aZUV3elNteGtiVGxxV1ZoU2NHSXlOSFpqTTFKb1pFaFdla3hYZUhCak0xRjJUV3BCTlVscGQybGpNMUpvWkVoV2VsUkhiSHBrUld4MVdrZFdORWxxYjJsTmFtZHBURU5LTUdWWVFteEphbTlwVlcxV01tSXlUbWhrUjJ4MlltdDRjR016VVhsTlJFbDRTVzR3YzBsdFRubGFWMUpzWW01U2NGbFhlRlJrVjBweFdsZE9NRWxxY0RkSmJXeHJTV3B2YVZwSGJHdFBiVll3WVVoSk5rMUlhRVphVlVwRFdrVlNSMUV5U1RGU1JWbDRUV3BHYkUxcVJtdE9SRlY1VG10T1IwNXRTVFJPUkdSc1VtMUdSMWw2VG0xYWFtZDRTV2wzYVdSSFZucGtRMGsyU1cwMWJHUXhVbXhqTTFGcFpsTjNhV0ZYVVdsUGFVcHZaRWhTZDJONmIzWk1Na1ozWVZNMU1tRlhVbXBoUjBad1ltazFkVnBZVVhaWldFSndURE5aZUV3elRtcGhSMVowV1ZoTmRrOVVhelZQVTBselNXMXNlbU16Vm14amFVazJaWGxLY0ZwRFNUWkpiVkp3V2tSd2JHUkhhSGxQYWtJMFVsUkdhMDlFU2tKT2VsWkdUVWROTVU5VVZrSk9WR014VGxSQ1JrNXJWWGxPYWxWNVdXcEJNVTFVVWtST2FtaENUbXBDYVUxNVNYTkpiVFZvWWxkVmFVOXBTbFZhV0U0d1lWYzFia2xGVW14a2JWWnpZak5DYkdOdVRXbG1VM2RwWkVoc2QxcFRTVFpYZVVwWFdsaEtjRnB0YkdoWmJYaHNVVE5LYkZwSFZuVmtSMnhvWWtOSmMwbHNVbXhqTTFKVlpWaENiRWxzTUhOSmJscG9Za2RzYTFaWE5UQmhWM2RwVDJsSmVVMUVTWHBNVkVGNlRGUkplbFpFUVRWUGFsVXhUMnBGTTB4cVRUSlBWbTlwWmxnd0xubHNUVmc1VVUwdFIySnZkMnBZYTBSdWNGQTBXamxyYVc1YVRFbGxXUzFQYUhKSWNESm1PSGhvVjBaMlRFNWlNRVpWVm1WRlVVYzFSblpTWTFaZmJVVm9jRGR4VHpsekxXZFhkMWw0U0ZZM1ZYaE1MV1pSSWl3aWNISnZiMlpRZFhKd2IzTmxJam9pWVhOelpYSjBhVzl1VFdWMGFHOWtJaXdpZEhsd1pTSTZJa1ZqWkhOaFUyVmpjREkxTm1zeFUybG5ibUYwZFhKbE1qQXhPU0lzSW5abGNtbG1hV05oZEdsdmJrMWxkR2h2WkNJNkltUnBaRHBsZEdoeU9qQjRSVEZrT0RKQk56VkZNR00xT1RWQk5UYzFOVEJGTmtVeU5qVXlZakExTVRSRE5qaEJOakJpTXlOclpYbHpMVEVpZlN3aWRIbHdaU0k2V3lKV1pYSnBabWxoWW14bFEzSmxaR1Z1ZEdsaGJDSXNJbFJsYzNSVWVYQmxJbDBzSW5aaGJHbGtWVzUwYVd3aU9pSXlNREl6TFRBekxUSXpWREE1T2pVMU9qRTNMak0yT1ZvaWZWMTlmUS5MeXRodHdLLUJ1MHE3Mm9kbW9XbldFTUY4T3JUTm9nSjE5d0ZCWnkzUkV2d2otYlNCanBNUDRqZ1JtMGhoa1ZOOXZNR1Z2NmE5MTlTMnhSbGZCd1lid0UiLCJwcm9vZlB1cnBvc2UiOiJhc3NlcnRpb25NZXRob2QiLCJ0eXBlIjoiRWNkc2FTZWNwMjU2azFTaWduYXR1cmUyMDE5IiwidmVyaWZpY2F0aW9uTWV0aG9kIjoiZGlkOmV0aHI6MHhFZUJCZERGQ2I1REYxMjFlMjFkNDUyNkNGNmI4NDdlRmFGYzNmZjgxI2tleS0xIn0sInR5cGUiOiJWZXJpZmlhYmxlUHJlc2VudGF0aW9uIiwidmVyaWZpYWJsZUNyZWRlbnRpYWwiOlt7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly9hcGkudmlkY2hhaW4ubmV0L2FwaS92MS9jb250ZXh0cy92MSJdLCJjcmVkZW50aWFsU3RhdHVzIjp7ImlkIjoiaHR0cHM6Ly9kZXYudmlkY2hhaW4ubmV0L2FwaS92MS9yZXZvY2F0aW9uL2NyZWRlbnRpYWwtc3RhdHVzL3N0YXR1cy1saXN0LzIwOS9jcmVkZW50aWFsLzI4Iiwic3RhdHVzTGlzdENyZWRlbnRpYWwiOiJodHRwczovL2Rldi52aWRjaGFpbi5uZXQvYXBpL3YxL3Jldm9jYXRpb24vc3RhdHVzLWxpc3QvMjA5Iiwic3RhdHVzTGlzdEluZGV4IjoiMjgiLCJ0eXBlIjoiUmV2b2NhdGlvbkxpc3QyMDIxIn0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImlkIjoiZGlkOmV0aHI6MHhFZUJCZERGQ2I1REYxMjFlMjFkNDUyNkNGNmI4NDdlRmFGYzNmZjgxIiwidGVzdCI6Im5ld1Rlc3QifSwiaWQiOiJodHRwczovL2FwaS52aWRjaGFpbi5uZXQvYXBpL3YxL3NjaGVtYXMvOTk5OSIsImlzc3VhbmNlRGF0ZSI6IjIwMjMtMDMtMTNUMDk6NTU6MjEuMDAwWiIsImlzc3VlciI6eyJpZCI6ImRpZDpldGhyOjB4RTFkODJBNzVFMGM1OTVBNTc1NTBFNkUyNjUyYjA1MTRDNjhBNjBiMyIsIm5hbWUiOiJUZXN0aW5nIERldmVsb3BlcnMifSwicHJvb2YiOnsiY3JlYXRlZCI6IjIwMjMtMDMtMTNUMDk6NTU6MjEuMDAwWiIsImp3cyI6ImV5SmhiR2NpT2lKRlV6STFOa3NpTENKcmFXUWlPaUprYVdRNlpYUm9jam93ZUVVeFpEZ3lRVGMxUlRCak5UazFRVFUzTlRVd1JUWkZNalkxTW1Jd05URTBRelk0UVRZd1lqTWphMlY1Y3kweElpd2lkSGx3SWpvaVNsZFVJbjAuZXlKcFlYUWlPakUyTnpnM01ERXpNakVzSW1semN5STZJbVJwWkRwbGRHaHlPakI0UlRGa09ESkJOelZGTUdNMU9UVkJOVGMxTlRCRk5rVXlOalV5WWpBMU1UUkROamhCTmpCaU15SXNJblpqSWpwN0lrQmpiMjUwWlhoMElqcGJJbWgwZEhCek9pOHZkM2QzTG5jekxtOXlaeTh5TURFNEwyTnlaV1JsYm5ScFlXeHpMM1l4SWl3aWFIUjBjSE02THk5aGNHa3VkbWxrWTJoaGFXNHVibVYwTDJGd2FTOTJNUzlqYjI1MFpYaDBjeTkyTVNKZExDSmpjbVZrWlc1MGFXRnNVM1JoZEhWeklqcDdJbWxrSWpvaWFIUjBjSE02THk5a1pYWXVkbWxrWTJoaGFXNHVibVYwTDJGd2FTOTJNUzl5WlhadlkyRjBhVzl1TDJOeVpXUmxiblJwWVd3dGMzUmhkSFZ6TDNOMFlYUjFjeTFzYVhOMEx6SXdPUzlqY21Wa1pXNTBhV0ZzTHpJNElpd2ljM1JoZEhWelRHbHpkRU55WldSbGJuUnBZV3dpT2lKb2RIUndjem92TDJSbGRpNTJhV1JqYUdGcGJpNXVaWFF2WVhCcEwzWXhMM0psZG05allYUnBiMjR2YzNSaGRIVnpMV3hwYzNRdk1qQTVJaXdpYzNSaGRIVnpUR2x6ZEVsdVpHVjRJam9pTWpnaUxDSjBlWEJsSWpvaVVtVjJiMk5oZEdsdmJreHBjM1F5TURJeEluMHNJbU55WldSbGJuUnBZV3hUZFdKcVpXTjBJanA3SW1sa0lqb2laR2xrT21WMGFISTZNSGhGWlVKQ1pFUkdRMkkxUkVZeE1qRmxNakZrTkRVeU5rTkdObUk0TkRkbFJtRkdZek5tWmpneElpd2lkR1Z6ZENJNkltNWxkMVJsYzNRaWZTd2lhV1FpT2lKb2RIUndjem92TDJGd2FTNTJhV1JqYUdGcGJpNXVaWFF2WVhCcEwzWXhMM05qYUdWdFlYTXZPVGs1T1NJc0ltbHpjM1ZsY2lJNmV5SnBaQ0k2SW1ScFpEcGxkR2h5T2pCNFJURmtPREpCTnpWRk1HTTFPVFZCTlRjMU5UQkZOa1V5TmpVeVlqQTFNVFJETmpoQk5qQmlNeUlzSW01aGJXVWlPaUpVWlhOMGFXNW5JRVJsZG1Wc2IzQmxjbk1pZlN3aWRIbHdaU0k2V3lKV1pYSnBabWxoWW14bFEzSmxaR1Z1ZEdsaGJDSXNJbFJsYzNSVWVYQmxJbDBzSW5aaGJHbGtWVzUwYVd3aU9pSXlNREl6TFRBekxUSXpWREE1T2pVMU9qRTNMak0yT1ZvaWZYMC55bE1YOVFNLUdib3dqWGtEbnBQNFo5a2luWkxJZVktT2hySHAyZjh4aFdGdkxOYjBGVVZlRVFHNUZ2UmNWX21FaHA3cU85cy1nV3dZeEhWN1V4TC1mUSIsInByb29mUHVycG9zZSI6ImFzc2VydGlvbk1ldGhvZCIsInR5cGUiOiJFY2RzYVNlY3AyNTZrMVNpZ25hdHVyZTIwMTkiLCJ2ZXJpZmljYXRpb25NZXRob2QiOiJkaWQ6ZXRocjoweEUxZDgyQTc1RTBjNTk1QTU3NTUwRTZFMjY1MmIwNTE0QzY4QTYwYjMja2V5cy0xIn0sInR5cGUiOlsiVmVyaWZpYWJsZUNyZWRlbnRpYWwiLCJUZXN0VHlwZSJdLCJ2YWxpZFVudGlsIjoiMjAyMy0wMy0yM1QwOTo1NToxNy4zNjlaIn1dfX0.k5tCelPjWhlpZFm7CAE_w9wzv2U8FV15L-W_3dY63NGzUtSk5I2v60j5qQY4VvsKVEP3iNFQ3mKJM7YV1LNGkSVub5m92ssejndxS7yp37pPaAzAOV71GVdN1peeYKRAxBnn_Lz8yJKCOJQ6hLUnr4hZ_YtLIlZFcDu8VKojNNcNxq7gU-L1mXLGxWFU6_J-nUJvH0bI1xLc_F_Zo4hhgJO7ZS5WXYLA_dKx9fXwWuv0JkrlIXeKWg_UjdBMthF9jEm3ojGC3n8OI3evGNJCKO590WkA9pEtMqkk6SkECh4K_2jgZu6An7z2aNi3jkrCWagHPRN9pbT7CgWbEr0tsozskEa2rAfMKqEoYS3kjVxp8w4scwgF9V8OThUngsWy0ATi_WpWbTt9Bc79kf1X5sn_dhZ2v8p_uvogMoylUsvS9US02idF3HHskykHTpgoUc-dAaS-y94TuItKjIywKaO3g5M-AxSbTVmJuq2fXVsFtMfbXuT-6yErYiSmd7cKE2aNK7anYyitg2NRMagT4J2e-0XU9h49x1uIwRRxCCuazq7_bxIOCl41Pae1Td-VgpzMyuofCJdg6XgDeW-BmBwSEcnk1dEZ6827-aC_SBCF0kJc3Ra_wZ4-G_A9fEMhccAXkckBEwzOMzjQm8a39V-CmN8cA3EBEmkw1X6NEWc';
const ethrCredential = {
  '@context': [
    'https://www.w3.org/2018/credentials/v1',
    'https://api.vidchain.net/api/v1/contexts/v1',
  ],
  credentialStatus: {
    id: 'https://dev.vidchain.net/api/v1/revocation/credential-status/status-list/209/credential/28',
    statusListCredential:
      'https://dev.vidchain.net/api/v1/revocation/status-list/209',
    statusListIndex: '28',
    type: 'RevocationList2021',
  },
  credentialSubject: {
    id: 'did:ethr:0xEeBBdDFCb5DF121e21d4526CF6b847eFaFc3ff81',
    test: 'newTest',
  },
  id: 'https://api.vidchain.net/api/v1/schemas/9999',
  issuanceDate: '2023-03-13T09:55:21.000Z',
  issuer: {
    id: 'did:ethr:0xE1d82A75E0c595A57550E6E2652b0514C68A60b3',
    name: 'Testing Developers',
  },
  proof: {
    created: '2023-03-13T09:55:21.000Z',
    jws: 'eyJhbGciOiJFUzI1NksiLCJraWQiOiJkaWQ6ZXRocjoweEUxZDgyQTc1RTBjNTk1QTU3NTUwRTZFMjY1MmIwNTE0QzY4QTYwYjMja2V5cy0xIiwidHlwIjoiSldUIn0.eyJpYXQiOjE2Nzg3MDEzMjEsImlzcyI6ImRpZDpldGhyOjB4RTFkODJBNzVFMGM1OTVBNTc1NTBFNkUyNjUyYjA1MTRDNjhBNjBiMyIsInZjIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly9hcGkudmlkY2hhaW4ubmV0L2FwaS92MS9jb250ZXh0cy92MSJdLCJjcmVkZW50aWFsU3RhdHVzIjp7ImlkIjoiaHR0cHM6Ly9kZXYudmlkY2hhaW4ubmV0L2FwaS92MS9yZXZvY2F0aW9uL2NyZWRlbnRpYWwtc3RhdHVzL3N0YXR1cy1saXN0LzIwOS9jcmVkZW50aWFsLzI4Iiwic3RhdHVzTGlzdENyZWRlbnRpYWwiOiJodHRwczovL2Rldi52aWRjaGFpbi5uZXQvYXBpL3YxL3Jldm9jYXRpb24vc3RhdHVzLWxpc3QvMjA5Iiwic3RhdHVzTGlzdEluZGV4IjoiMjgiLCJ0eXBlIjoiUmV2b2NhdGlvbkxpc3QyMDIxIn0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImlkIjoiZGlkOmV0aHI6MHhFZUJCZERGQ2I1REYxMjFlMjFkNDUyNkNGNmI4NDdlRmFGYzNmZjgxIiwidGVzdCI6Im5ld1Rlc3QifSwiaWQiOiJodHRwczovL2FwaS52aWRjaGFpbi5uZXQvYXBpL3YxL3NjaGVtYXMvOTk5OSIsImlzc3VlciI6eyJpZCI6ImRpZDpldGhyOjB4RTFkODJBNzVFMGM1OTVBNTc1NTBFNkUyNjUyYjA1MTRDNjhBNjBiMyIsIm5hbWUiOiJUZXN0aW5nIERldmVsb3BlcnMifSwidHlwZSI6WyJWZXJpZmlhYmxlQ3JlZGVudGlhbCIsIlRlc3RUeXBlIl0sInZhbGlkVW50aWwiOiIyMDIzLTAzLTIzVDA5OjU1OjE3LjM2OVoifX0.ylMX9QM-GbowjXkDnpP4Z9kinZLIeY-OhrHp2f8xhWFvLNb0FUVeEQG5FvRcV_mEhp7qO9s-gWwYxHV7UxL-fQ',
    proofPurpose: 'assertionMethod',
    type: 'EcdsaSecp256k1Signature2019',
    verificationMethod:
      'did:ethr:0xE1d82A75E0c595A57550E6E2652b0514C68A60b3#keys-1',
  },
  type: ['VerifiableCredential', 'TestType'],
  validUntil: '2023-03-23T09:55:17.369Z',
};
const idTokenForEbsiPresentation =
  'eyJhbGciOiJSUzI1NiIsImtpZCI6InB1YmxpYzozYTFlM2RkYS1iOWVhLTQwYjctOGEwOS0wYjY5ZWQwZDMxMTYiLCJ0eXAiOiJKV1QifQ.eyJhdF9oYXNoIjoiUlBvUGFMOUJmRlZ2cnR4eEZYZjMzZyIsImF1ZCI6WyJ1bml2ZXJzYWwtdmVyaWZpZXIiXSwiYXV0aF90aW1lIjoxNjc4NzgwNzI0LCJkaWQiOiJkaWQ6ZWJzaTp6aU1IY1dpa1lvQmVEaWlzRzhETmVNSmU4YzRGVExESGFLUUU1NktqSmZvanciLCJleHAiOjE2Nzg3ODQzMjYsImlhdCI6MTY3ODc4MDcyNiwiaXNzIjoiaHR0cHM6Ly9kZXYudmlkY2hhaW4ubmV0LyIsImp0aSI6IjQ0ZTVlYjRjLTdiNzMtNDNkMi1iMWE2LWEzNTM0NTEwNTRiNiIsIm5vbmNlIjoiMWUyMDRhNDYtYmU1MS00ZTJmLWFjZTUtM2E2MWI1OGE0MjgzIiwicmF0IjoxNjc4NzgwNzE0LCJzaWQiOiI4OGM3MWNmYy1kZmI4LTQyNjktODA1Zi0xYjRhMmIyMTE1NTIiLCJzdWIiOiJkaWQ6ZWJzaTp6aU1IY1dpa1lvQmVEaWlzRzhETmVNSmU4YzRGVExESGFLUUU1NktqSmZvanciLCJzdWJfandrIjp7ImNydiI6InNlY3AyNTZrMSIsImtpZCI6IlhmUHJmMWZYalBRODlVa04zUWxSSm91NHJPQnoxWklxdDh1OUxKY0pSTVk9Iiwia3R5IjoiRUMiLCJ4IjoidWgzQ2xYRkxoUEp2SWRmemVnXzE0d1ktV0s3UXhhVUZSUlhxYzhBNXc4OCIsInkiOiJFRjVEWTdjcnJFUEJYOW9kS0ozR082V1VIMG5wYjI3VlRvN2p3V1Bpc2prIn0sInZwIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIl0sImhvbGRlciI6ImRpZDplYnNpOnppTUhjV2lrWW9CZURpaXNHOEROZU1KZThjNEZUTERIYUtRRTU2S2pKZm9qdyIsImlhdCI6MS42Nzg3ODA3MjJlKzA5LCJpc3MiOiJkaWQ6ZWJzaTp6aU1IY1dpa1lvQmVEaWlzRzhETmVNSmU4YzRGVExESGFLUUU1NktqSmZvanciLCJwcm9vZiI6eyJjcmVhdGVkIjoiMjAyMy0wMy0xNFQwNzo1ODo0Mi4wMDBaIiwiandzIjoiZXlKaGJHY2lPaUpGVXpJMU5rc2lMQ0pxZDJzaU9uc2lZM0oySWpvaWMyVmpjREkxTm1zeElpd2lhM1I1SWpvaVJVTWlMQ0o0SWpvaWRXZ3pRMnhZUmt4b1VFcDJTV1JtZW1Wblh6RTBkMWt0VjBzM1VYaGhWVVpTVWxoeFl6aEJOWGM0T0NJc0lua2lPaUpGUmpWRVdUZGpjbkpGVUVKWU9XOWtTMG96UjA4MlYxVklNRzV3WWpJM1ZsUnZOMnAzVjFCcGMycHJJbjBzSW10cFpDSTZJbVJwWkRwbFluTnBPbnBwVFVoalYybHJXVzlDWlVScGFYTkhPRVJPWlUxS1pUaGpORVpVVEVSSVlVdFJSVFUyUzJwS1ptOXFkeU5hYlVkUlZVbzJlVkEwZGs1SExWSlhVMHBpT0hCTFdHVk9UR05QY1hWUWIwWm5RVGd4ZG14VmNWaEpJaXdpZEhsd0lqb2lTbGRVSW4wLmV5SkFZMjl1ZEdWNGRDSTZXeUpvZEhSd2N6b3ZMM2QzZHk1M015NXZjbWN2TWpBeE9DOWpjbVZrWlc1MGFXRnNjeTkyTVNKZExDSm9iMnhrWlhJaU9pSmthV1E2WldKemFUcDZhVTFJWTFkcGExbHZRbVZFYVdselJ6aEVUbVZOU21VNFl6UkdWRXhFU0dGTFVVVTFOa3RxU21admFuY2lMQ0pwWVhRaU9qRTJOemczT0RBM01qSXNJbWx6Y3lJNkltUnBaRHBsWW5OcE9ucHBUVWhqVjJscldXOUNaVVJwYVhOSE9FUk9aVTFLWlRoak5FWlVURVJJWVV0UlJUVTJTMnBLWm05cWR5SXNJblI1Y0dVaU9pSldaWEpwWm1saFlteGxVSEpsYzJWdWRHRjBhVzl1SWl3aWRtVnlhV1pwWVdKc1pVTnlaV1JsYm5ScFlXd2lPbHQ3SW1SaGRHRWlPaUpsZVVweVlWZFJhVTlwU210aFYxRTJZVzVrY2s5dFZqVlRia3ByVTBkMGNGUXliRXRWUmsxNFVWZHNUVkV3YjNoWmVrcFdZVlU1Y0ZOdWNHaFdNazV3VkVWT1MyRnRUblZYVjJ4UVlWVndSMWRyVWtwTlZUVlZVbFJXU21GWVpIQlpWRXB6WVRCc2NXSXliRTlOYkVWNVYxUktTMkpWTVhGVlZGSlFWakJzTmxSclVrcE5NRFYwVTFob1QyVnJiRFJVTVZKQ1RWVTFSV0pIZEU1aGF6QXhWRlpTYm1GVmVFUlRhbEpLWVcwNWNGVnRNREZTYkZwWFZtMW9hMVl4U2pCVU1WSnpWREF4TmxGdGJGQlNSVXA0V1ROd2IxWXlVa1ZWYTBwcFlYcHJNRnBIZUV0Tk1XUkpWVzAxVm1KVk5VMVpNVkpQWW14R2NtSkVSbEJSTUd4NlUxY3hSMk14Y0RWVFZGcEtZVEZhY2xWcldrOVJhMngxVFVOTmQwbHBkMmxrU0d4M1NXcHZhVk5zWkZWSmFYZHBXVmQ0YmtscWIybFNWMUpGVlRCRmFXWlJMbVY1U25Cak0wMXBUMmxLYTJGWFVUWmhibVJ5VDIxV05WTnVTbXRUUjNSd1ZESnNTMVZHVFhoUlYyeE5VVEJ2ZUZsNlNsWmhWVGx3VTI1d2FGWXlUbkJVUlU1TFlXMU9kVmRYYkZCaFZYQkhWMnRTU2sxVk5WVlNWRlpLWVZoa2NGbFVTbk5oTUd4eFlqSnNUMDFzUlhsWFZFcExZbFV4Y1ZWVVVsQldNR3cyVkd0U1NrMHdOWFJUV0doUFpXdHNORlF4VWtKTlZUVkZZa2QwVG1Gck1ERlVWbEp1WVZWNFJGTnFVa3BoYlRsd1ZXMHdNVkpzV2xkV2JXaHJWakZLTUZReFVuTlVNREUyVVcxc1VGSkZTbmhaTTNCdlZqSlNSVlZyU21saGVtc3dXa2Q0UzAweFpFbFZiVFZXWWxVMVRWa3hVazlpYkVaeVlrUkdVRkV3YkhwVFZ6RkhZekZ3TlZOVVdrcGhNVnB5Vld0YVQxRnJiSFZOUTBselNXNU9NVmxwU1RaSmJWSndXa1J3YkZsdVRuQlBibkJ3VkZWb2FsWXliSEpYVnpsRFdsVlNjR0ZZVGtoUFJWSlBXbFV4UzFwVWFHcE9SVnBWVkVWU1NWbFZkRkpTVkZVeVV6SndTMXB0T1hGa2VVbHpTVzAxYVZwcFNUWk5WRmt6VG5wVk0wMTZWVFJOYVhkcFlWZEdNRWxxYjNoT2FtTXpUbFJqZWs1VVozbE1RMG95V1hsSk5tVjVTakJsV0VKc1NXcHdZa2xzV214amJXeHRZVmRHYVdKSFZrUmpiVlpyV2xjMU1HRlhSbk5KYVhkcFZtMVdlV0ZYV25CWlYwcHpXbFZHTUdSSFZucGtSMFl3WVZjNWRVbHBkMmxXYlZaNVlWZGFjRmxYU25OYVZXeHJTV3d3YzBsclFtcGlNalV3V2xob01FbHFjR0pKYldnd1pFaENlazlwT0haa00yUXpURzVqZWt4dE9YbGFlVGg1VFVSRk5Fd3lUbmxhVjFKc1ltNVNjRmxYZUhwTU0xbDRTV3d3YzBsdGJHdEphbTlwWkZoS2RVOXVWakZoVjFFMlQxZE9hRTlIVm1sTlJHZDBUbGROTkUxVE1EQk5ha1V6VEZkRk5GcFVTWFJhUjFVMVdYcEZNRnBxV1RWTmVsRTBTV2wzYVdGWVRucGtWMVo1U1dwdmFWcEhiR3RQYlhBellYcHdiR1ZWY0hsYVJXaHlZVlU1Y0ZOc1FsUk5WVVp3VkVWT1MwMVhUWGxXVjJ4UVlWVndObGxXWkdwaFZYaEVVMjF3YW1Kc2JIQlVNbXhMVW14d1JWTlVSazlXUlZVeFUxZHNNMkZYUlhsaVIzUktZVzA1Y0ZScVNsSk5iR3Q1VTIweFRtRnNSVEJVTVdSS1pXczFSVk5VVGs5aVZXdzBWRzV3U21WRk9WVlJWRVpQVWtkNGNsUlhjRTVPVlRGVldqSnNUVkV3YnpCVFYzQjJZVlpLZEU1VldsZFdiRnB2V2taa1UyUkZPVlZpUlRsT1pXdEtjRlF3VWtOalYwNDJZVVprYTFKR1NrTlpiWE0xVGtkU2MxTnFUbGhUUmtwMVZsY3hUMVJIVGxWVWJUVlNZVEozZUZRd1RrcGpNR3gwVW01T1lXVlZhekpUVjNSWFlURktSMVJyU2twaWFrRnBURU5LY0dNelRqRlpWelZxV2xWU2FHUkhWV2xQYVVsNVRVUkpla3hVUVhsTVZFazBWa1JCTkU5cVRUVlBhbEY1VjJsSmMwbHRiSHBqTTFac1drTkpOa2xxU1hkTmFrMTBUVVJKZEUxcWFGVk5SR2MyVFhwck5rNUVTbUZKYVhkcFpHMUdjMkZYVWtkamJUbDBTV3B2YVUxcVFYbE5lVEIzVFdrd2VVOUdVWGRQUkc5NlQxUnZNRTFzYjJsTVEwcHFZMjFXYTFwWE5UQmhWMFp6VlRKT2IxcFhNV2hKYW5BM1NXMXNhMGxxYjJsaFNGSXdZMGhOTmt4NU9YbFpXR04xV2pKc01HRklWbWxrV0U1c1kyMU9kbUp1VW14aWJsRjFXVEk1ZEV3elpHaGlTRkYwWVZkUmRtUXlSbk5rUjJ4clRGaE9lbUZYZEhCa1F6RXlXVEo0Y0ZscE9YUlpXRTR3V2xoSmRtTXpTbXBNTTFKc1l6TlJkbU50Vm5waU0xWjVXVEpXZWt3elRtcGhSMVowV1ZoTmRsWnRWbmxoVjFwd1dWZEtjMXBWYkd0TWJYQjZZakkwYVV4RFNqQmxXRUpzU1dwdmFWSnVWbk5pUlhCNllqSTFWRmt5YUd4aVYwWlhXVmQ0Y0ZwSFJqQmlNMGw1VFVSSmVFbHVNSE5KYlU1NVdsZFNiR0p1VW5CWlYzaFVaRmRLY1ZwWFRqQkphbkEzU1cxc2EwbHFiMmxhUjJ4clQyMVdhV015YXpabGJXeE9VMGRPV0dGWGRGcGlNRXBzVWtkc2NHTXdZelJTUlRWc1ZGVndiRTlIVFRCU2JGSk5Va1ZvYUZNeFJrWk9WRnBNWVd0d2JXSXljRE5KYVhkcFdUTldlV050Vm5Wa1JVWnJXa2hLYkdNelRXbFBiSE5wVFZOQ1EySXpWbk5hV0Zwb1kyMVJaMXBIVldkaVIwVm5WRWRzYVZwWVNqQjNObXR6U1VSVk5VOUVRWGRKUlhod1lrZDRiRWxzTUhOSmJWSm9aRWRXVUZwclNuQmpibEp2U1dwdmFVMVVhelZOZVRCM1RrTXdkMDlEU1hOSmJWcG9ZbGRzYzJWVk5XaGlWMVZwVDJsS1JWUXdWV2xNUTBwdFlWaEtlbVJGTldoaVYxVnBUMmxLUzFsWE5XeEphWGRwV2pKV2RWcEhWbmxKYW05cFVtdFdUbEZWZUVaSmFYZHBZbTFHZEZwVlJuVmFSVnBvWWxkc2MyVlZOV2hpVjFaQ1pFVktjR051VW05SmFtOXBVMjFHZFZwVFFrVlVNRlZwVEVOS2QxcFlTbnBpTWpWb1lrVnNhMXBYTlRCaFYxcHdXbGhKYVU5cFNYZFBWRUV3VFVSQk5FMUVaekJUUTBselNXNUNjMWxYVG14VU1scERZVmhLTUdGRFNUWkphM2hLVkVWNFJreERRa2RWYTBaUFVUQlZhV1pUZDJsYVdGcHdXa2RXZFZreVZXbFBiSFEzU1cxU2Rsa3pWblJhVnpVd1ZVaEtiR015Vm5WWk1sVnBUMnh6YVZWSGFEVmpNbXhxV1ZkM2FWaFRkMmxhV0Zwd1drZFdkVmt5VmtWaU1rNHhZbGRXZFdSRFNUWlhlVXBSV1ZoT2VtTkhPWGxrUTBwa1RFTktlbVJYU25GYVYwNHdWVWhLYkdNeVZuVlpNbFZwVDJsS1VXRkliSHBoVjA1b1lrTkpjMGx1VWpWalIxVnBUMnh6YVZKSE9XcGtWekZzWW01U1YxcFlTbkJhYld4cVdWaFNjR0l5TkdsWVUzZHBaRzFXZVdGWFduQmFXRWxwVDJsS2EyRlhVVFphVjBwNllWUnZlVkZVYkVOWGFteFVWbGRWTWxGdFJqQlpWMDVVWTBoYWVrMVdXVEZSTWxKeFUwaGFUV05HUlROWmExWjZZVlJLUzFscVdrMWFSV2hNWW14R05GbFZOR2xtVmpFNVRFTktjV1JIYTJsUGFVb3hZMjAwTm1SWVZuQmFSRzgxV1RKRk5GcFhTWGRQUXpBeFdYcG5lRXhVVVhsTlZHTjBXVlJvYkUxcE1XdGFWR3hxVFZSU2JVNXFhM3BPUkdkcFpsRWlMQ0pvWldGa1pYSWlPbnNpWVd4bklqb2lSV1JFVTBFaUxDSnJhV1FpT2lKa2FXUTZhbmRyT21WNVNuSmtTR3RwVDJsS1VGTXhRV2xNUTBveFl6SlZhVTlwU25waFYyTnBURU5LYW1OdVdXbFBhVXBHV2tSSk1VNVVSVFZKYVhkcFlUSnNhMGxxYjJsT01sRXlXVEpLYlUxcVVUUlBWMGw2VGtSSk0wNXRTWGhPZWtsNFQxUkJNVTVFYkd0TmFrMDFUVlJuYVV4RFNqUkphbTlwVW0wMVJsWldWbWhrVjFKMFQxUnNUMDE2UW1sUFJFSnhZM3BvVjJSRVVrSmlhemswWkd4S00xZElVbTVWYlU1TVkxUk9ibEZyYkRGUFEwbHpTVzFHYzFwNVNUWkphMVpyVWtaT1FrbHVNQ013SWl3aWRIbHdJam9pU2xkVUluMHNJbkJoZVd4dllXUWlPbnNpYVdGMElqb3hOamMzTlRjek5UZ3lMQ0pwYzNNaU9pSmthV1E2YW5kck9tVjVTbkprU0d0cFQybEtVRk14UVdsTVEwb3hZekpWYVU5cFNucGhWMk5wVEVOS2FtTnVXV2xQYVVwR1drUkpNVTVVUlRWSmFYZHBZVEpzYTBscWIybE9NbEV5V1RKS2JVMXFVVFJQVjBsNlRrUkpNMDV0U1hoT2VrbDRUMVJCTVU1RWJHdE5hazAxVFZSbmFVeERTalJKYW05cFVtMDFSbFpXVm1oa1YxSjBUMVJzVDAxNlFtbFBSRUp4WTNwb1YyUkVVa0ppYXprMFpHeEtNMWRJVW01VmJVNU1ZMVJPYmxGcmJERlBRMGx6U1cxR2MxcDVTVFpKYTFaclVrWk9Ra2x1TUNJc0ltcDBhU0k2SW5WeWJqcDFkV2xrT2psallUaGxZakE0TFRWak9ERXROREl4TnkxaE9HVXlMV1JsT1dNeE5HWTJPVE0wT0NJc0ltNWlaaUk2TVRZM056VTNNelU0TWl3aWMzVmlJam9pWkdsa09tVmljMms2ZW1sTlNHTlhhV3RaYjBKbFJHbHBjMGM0UkU1bFRVcGxPR00wUmxSTVJFaGhTMUZGTlRaTGFrcG1iMnAzSWl3aWRtTWlPbnNpUUdOdmJuUmxlSFFpT2xzaWFIUjBjSE02THk5M2QzY3Vkek11YjNKbkx6SXdNVGd2WTNKbFpHVnVkR2xoYkhNdmRqRWlYU3dpWTNKbFpHVnVkR2xoYkZOamFHVnRZU0k2ZXlKcFpDSTZJbWgwZEhCek9pOHZjbUYzTG1kcGRHaDFZblZ6WlhKamIyNTBaVzUwTG1OdmJTOTNZV3gwTFdsa0wzZGhiSFJwWkMxemMybHJhWFF0ZG1Oc2FXSXZiV0Z6ZEdWeUwzTnlZeTkwWlhOMEwzSmxjMjkxY21ObGN5OXpZMmhsYldGekwxWmxjbWxtYVdGaWJHVkpaQzVxYzI5dUlpd2lkSGx3WlNJNklrWjFiR3hLYzI5dVUyTm9aVzFoVm1Gc2FXUmhkRzl5TWpBeU1TSjlMQ0pqY21Wa1pXNTBhV0ZzVTNWaWFtVmpkQ0k2ZXlKamRYSnlaVzUwUVdSa2NtVnpjeUk2V3lJeElFSnZkV3hsZG1GeVpDQmtaU0JzWVNCTWFXSmxjblREcVN3Z05UazRNREFnVEdsc2JHVWlYU3dpWkdGMFpVOW1RbWx5ZEdnaU9pSXhPVGt6TFRBMExUQTRJaXdpWm1GdGFXeDVUbUZ0WlNJNklrUlBSU0lzSW1acGNuTjBUbUZ0WlNJNklrcGhibVVpTENKblpXNWtaWElpT2lKR1JVMUJURVVpTENKcFpDSTZJbVJwWkRwbFluTnBPbnBwVFVoalYybHJXVzlDWlVScGFYTkhPRVJPWlUxS1pUaGpORVpVVEVSSVlVdFJSVFUyUzJwS1ptOXFkeUlzSW01aGJXVkJibVJHWVcxcGJIbE9ZVzFsUVhSQ2FYSjBhQ0k2SWtwaGJtVWdSRTlGSWl3aWNHVnljMjl1WVd4SlpHVnVkR2xtYVdWeUlqb2lNRGt3TkRBd09EQTRORWdpTENKd2JHRmpaVTltUW1seWRHZ2lPaUpNU1V4TVJTd2dSbEpCVGtORkluMHNJbVYyYVdSbGJtTmxJanBiZXlKa2IyTjFiV1Z1ZEZCeVpYTmxibU5sSWpwYklsQm9lWE5wWTJGc0lsMHNJbVYyYVdSbGJtTmxSRzlqZFcxbGJuUWlPbHNpVUdGemMzQnZjblFpWFN3aWMzVmlhbVZqZEZCeVpYTmxibU5sSWpvaVVHaDVjMmxqWVd3aUxDSjBlWEJsSWpwYklrUnZZM1Z0Wlc1MFZtVnlhV1pwWTJGMGFXOXVJbDBzSW5abGNtbG1hV1Z5SWpvaVpHbGtPbVZpYzJrNk1rRTVRbG81VTFWbE5rSmhkR0ZqVTNCMmN6RldOVU5rYWtoMlRIQlJOMkpGYzJreVNtSTJUR1JJUzI1UmVHRk9JbjFkTENKcFpDSTZJblZ5YmpwMWRXbGtPamxqWVRobFlqQTRMVFZqT0RFdE5ESXhOeTFoT0dVeUxXUmxPV014TkdZMk9UTTBPQ0lzSW1semMzVmhibU5sUkdGMFpTSTZJakl3TWpNdE1ESXRNamhVTURnNk16azZOREphSWl3aWFYTnpkV1ZrSWpvaU1qQXlNeTB3TWkweU9GUXdPRG96T1RvME1sb2lMQ0pwYzNOMVpYSWlPaUprYVdRNmFuZHJPbVY1U25Ka1NHdHBUMmxLVUZNeFFXbE1RMG94WXpKVmFVOXBTbnBoVjJOcFRFTkthbU51V1dsUGFVcEdXa1JKTVU1VVJUVkphWGRwWVRKc2EwbHFiMmxPTWxFeVdUSktiVTFxVVRSUFYwbDZUa1JKTTA1dFNYaE9la2w0VDFSQk1VNUViR3ROYWswMVRWUm5hVXhEU2pSSmFtOXBVbTAxUmxaV1ZtaGtWMUowVDFSc1QwMTZRbWxQUkVKeFkzcG9WMlJFVWtKaWF6azBaR3hLTTFkSVVtNVZiVTVNWTFST2JsRnJiREZQUTBselNXMUdjMXA1U1RaSmExWnJVa1pPUWtsdU1DSXNJblI1Y0dVaU9sc2lWbVZ5YVdacFlXSnNaVU55WldSbGJuUnBZV3dpTENKV1pYSnBabWxoWW14bFFYUjBaWE4wWVhScGIyNGlMQ0pXWlhKcFptbGhZbXhsU1dRaVhTd2lkbUZzYVdSR2NtOXRJam9pTWpBeU15MHdNaTB5T0ZRd09Eb3pPVG8wTWxvaWZYMHNJbk5wWjI1aGRIVnlaU0k2SW5kSlV6TmhZMDF1UTBZMlpIcGhRazVaWmxocE0wOTRXVmRCYUU1RFJrNXplVEpGV1ZCV1lVbFlVSGxPUm1zNFFtdDJkRll5TVZSdk1IRndXVXc1Y1djM1RXNUxTM0ZMZGtwbFZVRkZhalJUVjNkTVUwTjNJbjFkZlEuNS1iNmRMdTE5OHVrYUkwVTRyOUxTLWJ5T2RYNjFDb045LTRwSHlzNWZCbFFCcHM0V1VTbEdTbzczQWpQclNzaHZValhiR1NUVnljVVZYR3VoMndxSXciLCJwcm9vZlB1cnBvc2UiOiJhc3NlcnRpb25NZXRob2QiLCJ0eXBlIjoiRWNkc2FTZWNwMjU2azFTaWduYXR1cmUyMDE5IiwidmVyaWZpY2F0aW9uTWV0aG9kIjoiZGlkOmVic2k6emlNSGNXaWtZb0JlRGlpc0c4RE5lTUplOGM0RlRMREhhS1FFNTZLakpmb2p3I2tleXMtMSJ9LCJ0eXBlIjoiVmVyaWZpYWJsZVByZXNlbnRhdGlvbiIsInZlcmlmaWFibGVDcmVkZW50aWFsIjpbeyJkYXRhIjoiZXlKcmFXUWlPaUprYVdRNmFuZHJPbVY1U25Ka1NHdHBUMmxLVUZNeFFXbE1RMG94WXpKVmFVOXBTbnBoVjJOcFRFTkthbU51V1dsUGFVcEdXa1JKTVU1VVJUVkphWGRwWVRKc2EwbHFiMmxPTWxFeVdUSktiVTFxVVRSUFYwbDZUa1JKTTA1dFNYaE9la2w0VDFSQk1VNUViR3ROYWswMVRWUm5hVXhEU2pSSmFtOXBVbTAxUmxaV1ZtaGtWMUowVDFSc1QwMTZRbWxQUkVKeFkzcG9WMlJFVWtKaWF6azBaR3hLTTFkSVVtNVZiVTVNWTFST2JsRnJiREZQUTBselNXMUdjMXA1U1RaSmExWnJVa1pPUWtsdU1DTXdJaXdpZEhsd0lqb2lTbGRVSWl3aVlXeG5Jam9pUldSRVUwRWlmUS5leUpwYzNNaU9pSmthV1E2YW5kck9tVjVTbkprU0d0cFQybEtVRk14UVdsTVEwb3hZekpWYVU5cFNucGhWMk5wVEVOS2FtTnVXV2xQYVVwR1drUkpNVTVVUlRWSmFYZHBZVEpzYTBscWIybE9NbEV5V1RKS2JVMXFVVFJQVjBsNlRrUkpNMDV0U1hoT2VrbDRUMVJCTVU1RWJHdE5hazAxVFZSbmFVeERTalJKYW05cFVtMDFSbFpXVm1oa1YxSjBUMVJzVDAxNlFtbFBSRUp4WTNwb1YyUkVVa0ppYXprMFpHeEtNMWRJVW01VmJVNU1ZMVJPYmxGcmJERlBRMGx6U1cxR2MxcDVTVFpKYTFaclVrWk9Ra2x1TUNJc0luTjFZaUk2SW1ScFpEcGxZbk5wT25wcFRVaGpWMmxyV1c5Q1pVUnBhWE5IT0VST1pVMUtaVGhqTkVaVVRFUklZVXRSUlRVMlMycEtabTlxZHlJc0ltNWlaaUk2TVRZM056VTNNelU0TWl3aWFXRjBJam94TmpjM05UY3pOVGd5TENKMll5STZleUowZVhCbElqcGJJbFpsY21sbWFXRmliR1ZEY21Wa1pXNTBhV0ZzSWl3aVZtVnlhV1pwWVdKc1pVRjBkR1Z6ZEdGMGFXOXVJaXdpVm1WeWFXWnBZV0pzWlVsa0lsMHNJa0JqYjI1MFpYaDBJanBiSW1oMGRIQnpPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1ERTRMMk55WldSbGJuUnBZV3h6TDNZeElsMHNJbWxrSWpvaWRYSnVPblYxYVdRNk9XTmhPR1ZpTURndE5XTTRNUzAwTWpFM0xXRTRaVEl0WkdVNVl6RTBaalk1TXpRNElpd2lhWE56ZFdWeUlqb2laR2xrT21wM2F6cGxlVXB5WkVocmFVOXBTbEJUTVVGcFRFTktNV015VldsUGFVcDZZVmRqYVV4RFNtcGpibGxwVDJsS1JscEVTVEZPVkVVMVNXbDNhV0V5Ykd0SmFtOXBUakpSTWxreVNtMU5hbEUwVDFkSmVrNUVTVE5PYlVsNFRucEplRTlVUVRGT1JHeHJUV3BOTlUxVVoybE1RMG8wU1dwdmFWSnROVVpXVmxab1pGZFNkRTlVYkU5TmVrSnBUMFJDY1dONmFGZGtSRkpDWW1zNU5HUnNTak5YU0ZKdVZXMU9UR05VVG01UmEyd3hUME5KYzBsdFJuTmFlVWsyU1d0V2ExSkdUa0pKYmpBaUxDSnBjM04xWVc1alpVUmhkR1VpT2lJeU1ESXpMVEF5TFRJNFZEQTRPak01T2pReVdpSXNJbWx6YzNWbFpDSTZJakl3TWpNdE1ESXRNamhVTURnNk16azZOREphSWl3aWRtRnNhV1JHY205dElqb2lNakF5TXkwd01pMHlPRlF3T0Rvek9UbzBNbG9pTENKamNtVmtaVzUwYVdGc1UyTm9aVzFoSWpwN0ltbGtJam9pYUhSMGNITTZMeTl5WVhjdVoybDBhSFZpZFhObGNtTnZiblJsYm5RdVkyOXRMM2RoYkhRdGFXUXZkMkZzZEdsa0xYTnphV3RwZEMxMlkyeHBZaTl0WVhOMFpYSXZjM0pqTDNSbGMzUXZjbVZ6YjNWeVkyVnpMM05qYUdWdFlYTXZWbVZ5YVdacFlXSnNaVWxrTG1wemIyNGlMQ0owZVhCbElqb2lSblZzYkVwemIyNVRZMmhsYldGV1lXeHBaR0YwYjNJeU1ESXhJbjBzSW1OeVpXUmxiblJwWVd4VGRXSnFaV04wSWpwN0ltbGtJam9pWkdsa09tVmljMms2ZW1sTlNHTlhhV3RaYjBKbFJHbHBjMGM0UkU1bFRVcGxPR00wUmxSTVJFaGhTMUZGTlRaTGFrcG1iMnAzSWl3aVkzVnljbVZ1ZEVGa1pISmxjM01pT2xzaU1TQkNiM1ZzWlhaaGNtUWdaR1VnYkdFZ1RHbGlaWEowdzZrc0lEVTVPREF3SUV4cGJHeGxJbDBzSW1SaGRHVlBaa0pwY25Sb0lqb2lNVGs1TXkwd05DMHdPQ0lzSW1aaGJXbHNlVTVoYldVaU9pSkVUMFVpTENKbWFYSnpkRTVoYldVaU9pSktZVzVsSWl3aVoyVnVaR1Z5SWpvaVJrVk5RVXhGSWl3aWJtRnRaVUZ1WkVaaGJXbHNlVTVoYldWQmRFSnBjblJvSWpvaVNtRnVaU0JFVDBVaUxDSndaWEp6YjI1aGJFbGtaVzUwYVdacFpYSWlPaUl3T1RBME1EQTRNRGcwU0NJc0luQnNZV05sVDJaQ2FYSjBhQ0k2SWt4SlRFeEZMQ0JHVWtGT1EwVWlmU3dpWlhacFpHVnVZMlVpT2x0N0ltUnZZM1Z0Wlc1MFVISmxjMlZ1WTJVaU9sc2lVR2g1YzJsallXd2lYU3dpWlhacFpHVnVZMlZFYjJOMWJXVnVkQ0k2V3lKUVlYTnpjRzl5ZENKZExDSnpkV0pxWldOMFVISmxjMlZ1WTJVaU9pSlFhSGx6YVdOaGJDSXNJblI1Y0dVaU9sc2lSRzlqZFcxbGJuUldaWEpwWm1sallYUnBiMjRpWFN3aWRtVnlhV1pwWlhJaU9pSmthV1E2WldKemFUb3lRVGxDV2psVFZXVTJRbUYwWVdOVGNIWnpNVlkxUTJScVNIWk1jRkUzWWtWemFUSktZalpNWkVoTGJsRjRZVTRpZlYxOUxDSnFkR2tpT2lKMWNtNDZkWFZwWkRvNVkyRTRaV0l3T0MwMVl6Z3hMVFF5TVRjdFlUaGxNaTFrWlRsak1UUm1Oamt6TkRnaWZRIiwiaGVhZGVyIjp7ImFsZyI6IkVkRFNBIiwia2lkIjoiZGlkOmp3azpleUpyZEhraU9pSlBTMUFpTENKMWMyVWlPaUp6YVdjaUxDSmpjbllpT2lKRlpESTFOVEU1SWl3aWEybGtJam9pTjJRMlkySm1NalE0T1dJek5ESTNObUl4TnpJeE9UQTFORGxrTWpNNU1UZ2lMQ0o0SWpvaVJtNUZWVlZoZFdSdE9UbE9NekJpT0RCcWN6aFdkRFJCYms5NGRsSjNXSFJuVW1OTGNUTm5Ra2wxT0NJc0ltRnNaeUk2SWtWa1JGTkJJbjAjMCIsInR5cCI6IkpXVCJ9LCJwYXlsb2FkIjp7ImlhdCI6MS42Nzc1NzM1ODJlKzA5LCJpc3MiOiJkaWQ6andrOmV5SnJkSGtpT2lKUFMxQWlMQ0oxYzJVaU9pSnphV2NpTENKamNuWWlPaUpGWkRJMU5URTVJaXdpYTJsa0lqb2lOMlEyWTJKbU1qUTRPV0l6TkRJM05tSXhOekl4T1RBMU5EbGtNak01TVRnaUxDSjRJam9pUm01RlZWVmhkV1J0T1RsT016QmlPREJxY3poV2REUkJiazk0ZGxKM1dIUm5VbU5MY1ROblFrbDFPQ0lzSW1Gc1p5STZJa1ZrUkZOQkluMCIsImp0aSI6InVybjp1dWlkOjljYThlYjA4LTVjODEtNDIxNy1hOGUyLWRlOWMxNGY2OTM0OCIsIm5iZiI6MS42Nzc1NzM1ODJlKzA5LCJzdWIiOiJkaWQ6ZWJzaTp6aU1IY1dpa1lvQmVEaWlzRzhETmVNSmU4YzRGVExESGFLUUU1NktqSmZvanciLCJ2YyI6eyJAY29udGV4dCI6WyJodHRwczovL3d3dy53My5vcmcvMjAxOC9jcmVkZW50aWFscy92MSJdLCJjcmVkZW50aWFsU2NoZW1hIjp7ImlkIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3dhbHQtaWQvd2FsdGlkLXNzaWtpdC12Y2xpYi9tYXN0ZXIvc3JjL3Rlc3QvcmVzb3VyY2VzL3NjaGVtYXMvVmVyaWZpYWJsZUlkLmpzb24iLCJ0eXBlIjoiRnVsbEpzb25TY2hlbWFWYWxpZGF0b3IyMDIxIn0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImN1cnJlbnRBZGRyZXNzIjpbIjEgQm91bGV2YXJkIGRlIGxhIExpYmVydMOpLCA1OTgwMCBMaWxsZSJdLCJkYXRlT2ZCaXJ0aCI6IjE5OTMtMDQtMDgiLCJmYW1pbHlOYW1lIjoiRE9FIiwiZmlyc3ROYW1lIjoiSmFuZSIsImdlbmRlciI6IkZFTUFMRSIsImlkIjoiZGlkOmVic2k6emlNSGNXaWtZb0JlRGlpc0c4RE5lTUplOGM0RlRMREhhS1FFNTZLakpmb2p3IiwibmFtZUFuZEZhbWlseU5hbWVBdEJpcnRoIjoiSmFuZSBET0UiLCJwZXJzb25hbElkZW50aWZpZXIiOiIwOTA0MDA4MDg0SCIsInBsYWNlT2ZCaXJ0aCI6IkxJTExFLCBGUkFOQ0UifSwiZXZpZGVuY2UiOlt7ImRvY3VtZW50UHJlc2VuY2UiOlsiUGh5c2ljYWwiXSwiZXZpZGVuY2VEb2N1bWVudCI6WyJQYXNzcG9ydCJdLCJzdWJqZWN0UHJlc2VuY2UiOiJQaHlzaWNhbCIsInR5cGUiOlsiRG9jdW1lbnRWZXJpZmljYXRpb24iXSwidmVyaWZpZXIiOiJkaWQ6ZWJzaToyQTlCWjlTVWU2QmF0YWNTcHZzMVY1Q2RqSHZMcFE3YkVzaTJKYjZMZEhLblF4YU4ifV0sImlkIjoidXJuOnV1aWQ6OWNhOGViMDgtNWM4MS00MjE3LWE4ZTItZGU5YzE0ZjY5MzQ4IiwiaXNzdWFuY2VEYXRlIjoiMjAyMy0wMi0yOFQwODozOTo0MloiLCJpc3N1ZWQiOiIyMDIzLTAyLTI4VDA4OjM5OjQyWiIsImlzc3VlciI6ImRpZDpqd2s6ZXlKcmRIa2lPaUpQUzFBaUxDSjFjMlVpT2lKemFXY2lMQ0pqY25ZaU9pSkZaREkxTlRFNUlpd2lhMmxrSWpvaU4yUTJZMkptTWpRNE9XSXpOREkzTm1JeE56SXhPVEExTkRsa01qTTVNVGdpTENKNElqb2lSbTVGVlZWaGRXUnRPVGxPTXpCaU9EQnFjemhXZERSQmJrOTRkbEozV0hSblVtTkxjVE5uUWtsMU9DSXNJbUZzWnlJNklrVmtSRk5CSW4wIiwidHlwZSI6WyJWZXJpZmlhYmxlQ3JlZGVudGlhbCIsIlZlcmlmaWFibGVBdHRlc3RhdGlvbiIsIlZlcmlmaWFibGVJZCJdLCJ2YWxpZEZyb20iOiIyMDIzLTAyLTI4VDA4OjM5OjQyWiJ9fSwic2lnbmF0dXJlIjoid0lTM2FjTW5DRjZkemFCTllmWGkzT3hZV0FoTkNGTnN5MkVZUFZhSVhQeU5GazhCa3Z0VjIxVG8wcXBZTDlxZzdNbktLcUt2SmVVQUVqNFNXd0xTQ3cifV19fQ.YMc5aVAV6w4lDuevQJTC6IiOj6uxX5lXTaTLx-BIExlipUEzlp74MszZsSJJiNXDSraFWNa8Ek_vi9Lv0q7anKKUJYv2hwFAnC56qxncu-W2DiV0-t25dDKXoaPjH-UkEKTq4KlmD4E82z6S7MVlaX7GlclBYEP8D1gCdRNbmf7baMHYG5ra1nywAjxpKXO_cR5o9zBXhaawwld4UaFDbq4h_9WmmzPvlYRZtRgS8CVnW-du1YFQl064d_-10KfocAcaomO8l4HccsPNubxauiil3nli0OzWWaT8rmnSb1W3Q5xiSPzEh_T22t42iFy2ZiSG4naovALiu9VK5R02bBNPF-8qvd0yZR_GBkQscFblt1ab5uKuhF4Bzn2HpCuzc3BTigIhSiuZH2SBZT9BfmnDFnP0mII9qzVmqHXnhh7uHWCgl7o_vFtK9Xm2aEvbX5cTPmrZhR2B1V_60JEcr18zKzK_iw0l-hBaDY7TQHTpvOfxQhmppiWPg0O9aRMXnjdlbp_BMJDHKbcOQAZWz4tkNzOuWHnjiHld7w9otefSfmffr1PKZq3MefTRBKZMpnu2mQEQLqOTc-nBJo3sqh_x5xrflT2cMdMIzEBo-Zgzc1eni3vbygONUfTYbz7Tt6TsT2xC0EeYUxk5zRTWgwf5sk-ZxraS4-Tw1j0aDYM';
const ebsiCredential = {
  '@context': ['https://www.w3.org/2018/credentials/v1'],
  credentialSchema: {
    id: 'https://raw.githubusercontent.com/walt-id/waltid-ssikit-vclib/master/src/test/resources/schemas/VerifiableId.json',
    type: 'FullJsonSchemaValidator2021',
  },
  credentialSubject: {
    currentAddress: ['1 Boulevard de la LibertÃ©, 59800 Lille'],
    dateOfBirth: '1993-04-08',
    familyName: 'DOE',
    firstName: 'Jane',
    gender: 'FEMALE',
    id: 'did:ebsi:ziMHcWikYoBeDiisG8DNeMJe8c4FTLDHaKQE56KjJfojw',
    nameAndFamilyNameAtBirth: 'Jane DOE',
    personalIdentifier: '0904008084H',
    placeOfBirth: 'LILLE, FRANCE',
  },
  evidence: [
    {
      documentPresence: ['Physical'],
      evidenceDocument: ['Passport'],
      subjectPresence: 'Physical',
      type: ['DocumentVerification'],
      verifier: 'did:ebsi:2A9BZ9SUe6BatacSpvs1V5CdjHvLpQ7bEsi2Jb6LdHKnQxaN',
    },
  ],
  id: 'urn:uuid:9ca8eb08-5c81-4217-a8e2-de9c14f69348',
  issuanceDate: '2023-02-28T08:39:42Z',
  issued: '2023-02-28T08:39:42Z',
  issuer:
    'did:jwk:eyJrdHkiOiJPS1AiLCJ1c2UiOiJzaWciLCJjcnYiOiJFZDI1NTE5Iiwia2lkIjoiN2Q2Y2JmMjQ4OWIzNDI3NmIxNzIxOTA1NDlkMjM5MTgiLCJ4IjoiRm5FVVVhdWRtOTlOMzBiODBqczhWdDRBbk94dlJ3WHRnUmNLcTNnQkl1OCIsImFsZyI6IkVkRFNBIn0',
  type: ['VerifiableCredential', 'VerifiableAttestation', 'VerifiableId'],
  validFrom: '2023-02-28T08:39:42Z',
};
describe('authorization service', () => {
  const openIdApi = mock<OpenIdApi>();
  const authorizationService = new AuthorizationService(openIdApi);
  it('should return the credential of the id_token when there is a did:ethr presentation', () => {
    const authorizationDto: AuthorizationDto = {
      code: 'code',
      redirectUri: 'redirectUri',
    };
    const oauthToken: OauthToken = {
      access_token: 'access_token',
      id_token: idTokenForEthrPresentation,
      expires_in: 3600,
      scope: 'openid',
      token_type: 'Bearer',
    };
    openIdApi.getOauthToken.mockResolvedValue(oauthToken);
    expect(authorizationService.authorize(authorizationDto)).resolves.toEqual({
      verifiableCredential: ethrCredential,
    });
  });

  it('should return the credential of the id_token when there is a did:ebsi presentation', () => {
    const authorizationDto: AuthorizationDto = {
      code: 'code',
      redirectUri: 'redirectUri',
    };
    const oauthToken: OauthToken = {
      access_token: 'access_token',
      id_token: idTokenForEbsiPresentation,
      expires_in: 3600,
      scope: 'openid',
      token_type: 'Bearer',
    };
    openIdApi.getOauthToken.mockResolvedValue(oauthToken);
    expect(authorizationService.authorize(authorizationDto)).resolves.toEqual({
      verifiableCredential: ebsiCredential,
    });
  });
});
